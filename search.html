<!DOCTYPE html>
<html>

<head>
	<title>SLOTH_search</title>
	<meta name="viewport" content="initial-scale=1.0">
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="style_search.css">
	<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
	<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 350px;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
</head>

<body class="search">
	<div class="title">
	</div>
	<div class="category">
		<ul class="select">
			<li>WALK</li>
			<li>HIKE</li>
		</ul>
	</div>
	<div class="input" id="walkinput">
		<form onsubmit="return input()"> <!--action="walk_search.php" method="get">-->
			<div class="walk_form" id="lnk_nam">
				<p>Name of Trail<br></p><input type="text" id="trail" name="trail">
			</div>
			<div class="walk_form" id="cos_nam">
				<p>Name of Course<br></p><input type="text" id="course" name="course">
			</div>
			<div class="walk_form" id="cos_lvl">
				<p>Difficulty</p><br>
				<img src="" alt="easy"><br><input type="radio" name="difficulty" value="하"><br>
				<img src="" alt="medium"><br><input type="radio" name="difficulty" value="중"><br>
				<img src="" alt="hard"><br><input type="radio" name="difficulty" value="상"><br>
			</div>
			<div class="walk_form" id="len_time">
				<p>Consuming Time<br></p>
				<div class="range-slider"><p>
					<input class="slider-range" type="range" id="time" name="time" min="0" max="24">
					<span class="slider-value">12</span>
				</p></div>
			</div>
			<div class="walk_form" id="distance">
				<p>Distance from Current Position<br></p>
				<div class="range-slider"><p>
					<input class="slider-range" type="range" id="distance" name="distance" min="0" max="600000">
					<span class="slider-value">300000</span>
				</p></div>
				<div id="map"></div>
			<br><input type="submit" value="Submit"><br>
		</form>

		<script> // slider 옆에 실시간으로 값 띄우기
			var rangeSlider = function(){
				var slider = $('.range-slider'),
				range = $('.slider-range'),
				value = $('.slider-value');

				slider.each(function(){
					value.each(function(){
						var value = $(this).prev().attr('value');
						$(this).html(value);
					});
					range.on('input', function(){
						$(this).next(value).html(this.value);
					});
				});
			};
			rangeSlider();
		</script>

		<script> // forms에서 입력받은 데이터 가져오고 필터링하기
			var trail, course, difficulty, time, distance;
			function input() {
				if (this.readyState==4 && this.status==200) {
					trail = document.getElementById("trail").value;
					course = document.getElementById("course").value;
					var tempLevel = document.getElementByName("difficulty");
					for (var i=0 ; i<difficulty.length() ; i++) {
						if (sample[i].checked == true) {
							difficulty = sample[i].value;
						}
					}
					time = document.getElementById("time").value;
					distance = document.getElementById("distance").value;
				}

				var filter;
				if (trail != "")
					filter += "&filter=lnk_nam=" + trail;
				if (course != "")
					filter += "&filter=cos_nam=" + course;
				if (difficulty != null) filter += "&filter=cos_lvl:=:" + difficulty;
				if (time != null) filter += "&filter=len_time:<:" + time;

				alert(filter);
				
				var s = document.createElement("script");
				s.src = "http://apis.vworld.kr/2ddata/trkroad/data?apiKey=4CAD59E8-4728-3099-8B24-F00FB406A8BD&domain=https://cheonjihyun.github.io/sloth/&output=json"+filter;
				document.body.appendChild(s);

				if (distance != null) {
					if (navigator.geolocation) {
						navigator.geolocation.getCurrentPosition(function(position) {
							var cal = {
								lat: position.coords.latitude - distance,
								lng: position.coords.longitude - distance
							}
						})
					}
					filter += "&geometry=POINT(" + x + " " + y + ")";
				}
				
			}
		</script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2LWPm4NAkrHM43Si-C7PVOkQg4FSqrZ8&callback=initMap" async defer>
    	</script>
    	<script type="text/javascript">
    	// google map api 불러와서 지도 그리고 distance 입력값에 따라 원그리기
			var map, infoWindow;
    		function initMap() {
    			map = new google.maps.Map(document.getElementById("map"), {
    				center: new google.maps.LatLng(33.450701, 126.570667),
    				zoom: 10,
    				mapTypeId: google.maps.MapTypeId.roadmap
    			});
    			infoWindow = new google.maps.InfoWindow;
    			var circleOptions = new google.maps.Circle({
					strokeColor : "FF0000",
					strokeOpacity : 0.8,
					strokeWeight : 2,
					fillColor : "#FF0000",
					fillOpacity : 0.3,
					map : map,
					center : map.center,
					radius : 2000
					//document.getElementById("distance").value
				});

//   		google.maps.event.addDomListener(window, 'load', initMap);

			// Try HTML5 geolocation.
	   		if (navigator.geolocation) {
    				navigator.geolocation.getCurrentPosition(function(position) {
    					var pos = {
    						lat: position.coords.latitude,
    						lng: position.coords.longitude
    					};

    					infoWindow.setPosition(pos);
    					infoWindow.setContent('Location found.');
    					infoWindow.open(map);
    					map.setCenter(pos);
    				}, function() {
    					handleLocationError(true, infoWindow, map.getCenter());
    				});
    			} else {
    			// Browser doesn't support Geolocation
    			handleLocationError(false, infoWindow, map.getCenter());
    			}
    		}

    		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    			infoWindow.setPosition(pos);
    			infoWindow.setContent(browserHasGeolocation ?
    				'Error: The Geolocation service failed.' :
    				'Error: Your browser doesn\'t support geolocation.');
    			infoWindow.open(map);
    		}
    	</script>
	</div>

	<div class="input" id="hikeinput">
	</div>

	<div class="output" id=result>
		<p></p>
	</div>
</body>

</html>