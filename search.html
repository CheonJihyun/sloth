<!DOCTYPE html>
<html>

<head>
	<title>SLOTH_search</title>
	<meta name="viewport" content="initial-scale=1.0">
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="style_search">
	<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 350px;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
</head>

<body class="search">
	<div class="title">
	</div>
	<div class="category">
		<ul class="select">
			<li>WALK</li>
			<li>HIKE</li>
		</ul>
	</div>
	<div class="input" id="walkinput">
		<form> <!--action="walk_search.php" method="get">-->
			<div class="walk_form" id="lnk_nam">
				<p>Name of Trail<br></p><input type="text" id="trail" name="trail">
			</div>
			<div class="walk_form" id="cos_nam">
				<p>Name of Course<br></p><input type="text" id="course" name="course">
			</div>
			<div class="walk_form" id="cos_lvl">
				<p>Difficulty</p><br>
				<img src="" alt="easy"><br><input type="radio" name="difficulty" value="하"><br>
				<img src="" alt="medium"><br><input type="radio" name="difficulty" value="중"><br>
				<img src="" alt="hard"><br><input type="radio" name="difficulty" value="상"><br>
			</div>
			<div class="walk_form" id="len_time">
				<p>Consuming Time<br></p><input type="range" id="time" name="time" min="0" max="24">
			</div>
			<div class="walk_form" id="distance">
				<p>Distance from Current Position<br></p><input type="range" id="distance" name="distance">
				<div id="map">
				</div>
			</div>
			<input type="submit" value="Submit" onclick="input();">
		</form>

		<script>
			// forms에서 입력받은 데이터 가져오고 필터링하기
			var trail, course, difficulty, time, distance;
			function input() {
				if (this.readyState==4 && this.status==200) {
					trail = document.getElementById("trail").value;
					course = document.getElementById("course").value;
					var tempLevel = document.getElementByName("difficulty");
					for (var i=0 ; i<difficulty.length() ; i++) {
						if (sample[i].checked == true) {
							difficulty = sample[i].value;
						}
					}
					time = document.getElementById("time").value;
					distance = document.getElementById("distance").value;
				}

				var s = document.createElement("script");
				var filter, pos;
				if (trail != "") filter += "&filter=lnk_nam=" + trail;
				if (course != "") filter += "&filter=cos_nam=" + course;
				if (difficulty != null) filter += "&filter=cos_lvl:=:" + difficulty;
				if (time != null) filter += "&filter=len_time:<:" + time;

				s.src = "http://apis.vworld.kr/2ddata/trkroad/data?apiKey=4CAD59E8-4728-3099-8B24-F00FB406A8BD&domain=https://cheonjihyun.github.io/sloth/&output=json"+filter;
				document.body.appendChild(s);

				for (int i= ; i< ; i+=0.00001) {

				}


				if (distance != null) {
					if (navigator.geolocation) {
						navigator.geolocation.getCurrentPosition(function(position) {
							var cal = {
								lat: position.coords.latitude - distance,
								lng: position.coords.longitude - distance
							}
						})
					}
					filter += "&geometry=POINT(" + x + " " + y + ")";
				}
				
			}


			// google map api 불러와서 지도 그리고 distance 입력값에 따라 원그리기
			var map, infoWindow;
    		function initMap() {
    			map = new google.maps.Map(document.getElementById("map"), {
    				center: new google.maps.LatLng(33.450701, 126.570667),
    				zoom: 16,
    				mapTypeId: google.maps.MapTypeId.roadmap
    			});
    			infoWindow = new google.maps.InfoWindow;

				// Try HTML5 geolocation.
    			if (navigator.geolocation) {
    				navigator.geolocation.getCurrentPosition(function(position {
    					var pos = {
    						lat: position.coords.latitude,
    						lng: position.coords.longitude
    					};

    					infoWindow.setPosition(pos);
    					infoWindow.setContent('Location found.');
    					infoWindow.open(map);
    					map.setCenter(pos);
    				}, function() {
    					handleLocationError(true, infoWindow, map.getCenter());
    				});
    			} else {
    			// Browser doesn't support Geolocation
    			handleLocationError(false, infoWindow, map.getCenter());
    			}

	    		var circleOptions = new google.maps.Circle({
					strokeColor : "FF0000",
					strokeOpacity : 0.8,
					strokeWeight : 2,
					fillColor : "#FF0000",
					fillOpacity : 0.3,
					map : map,
					center : map.center,
					radius : distance
				}
				google.maps.event.addDomListener(window, 'load', initMap);
    		}

   	 	function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  	  		infoWindow.setPosition(pos);
    	 	infoWindow.setContent(browserHasGeolocation ?
    			'Error: The Geolocation service failed.' :
    			'Error: Your browser doesn\'t support geolocation.');
    		infoWindow.open(map);
   		}
    	</script>
    	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2LWPm4NAkrHM43Si-C7PVOkQg4FSqrZ8&callback=initMap" async defer>
    	</script>

<!--		<script>
			function getTrail(val) {
				xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function() {
					if (this.readyState==4 && this.status==200) {
						var myObj = JSON.parse(this.responseText);
						document.getElementById("trail").innerHTML = myObj.name;
					}
				}
				xmlhttp.open("GET", "walk_search.php? trail="+val, true);
				xmlhttp.send();
			}

			function getCourse(val) {
				xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function() {
					if (this.readyState==4 && this.status==200) {
						var myObj = JSON.parse(this.responseText);
						document.getElementById("course").innerHTML = myObj.name;
					}
				}
				xmlhttp.open("GET", "walk_search.php? course="+val, true);
				xmlhttp.send();
			}

			function getDifficulty(val) {
				xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function() {
					if (this.readyState==4 && this.status==200) {
						var myObj = JSON.parse(this.responseText);
						document.getElementById("difficulty").innerHTML = myObj.name;
					}
				}
				xmlhttp.open("GET", "walk_search.php? difficulty="+val, true);
				xmlhttp.send();
			}

			function getTime(val) {
				xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function() {
					if (this.readyState==4 && this.status==200) {
						var myObj = JSON.parse(this.responseText);
						document.getElementById("len_time").innerHTML = myObj.name;
					}
				}
				xmlhttp.open("GET", "walk_search.php? time="+val, true);
				xmlhttp.send();
			}
		</script>
	-->
	</div>

	<div class="input" id="hikeinput">
	</div>

	<div class="output" id=result>
		<p></p>
	</div>
</body>

</html>